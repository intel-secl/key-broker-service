<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.intel.mtwilson.kms</groupId>
    <artifactId>kms-zip</artifactId>
    
    <packaging>jar</packaging>
    <description>Key management server</description>
    
    <parent>
        <groupId>com.intel.mtwilson.kms</groupId>
        <artifactId>kms-maven-package-zip</artifactId>
        <version>5.1-SNAPSHOT</version>
        <relativePath/>
    </parent>
    
    <properties>
        <build.timestamp>${maven.build.timestamp}</build.timestamp>
        <maven.build.timestamp.format>yyyy-MM-dd'T'HH:mm:ss.SSSZ</maven.build.timestamp.format>
    </properties>
    
    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        <plugins>
            <plugin>
                <groupId>pl.project13.maven</groupId>
                <artifactId>git-commit-id-plugin</artifactId>
                <version>2.1.12</version>
                <executions>
                    <execution>
                        <phase>initialize</phase>
                        <goals>
                            <goal>revision</goal>
                        </goals>
                        <inherited>true</inherited>
                        <configuration>
                            <skipPoms>false</skipPoms>
                            <prefix>git</prefix>
                            <failOnNoGitDirectory>false</failOnNoGitDirectory>
                        </configuration>
                    </execution>
                </executions>
	</plugin>
	    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>mkdir-kms-application-share</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <mkdir dir="${project.basedir}/src/main/application/share/"/>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                         <dependencies>
                            <dependency>
                                <groupId>org.apache.ant</groupId>
                                <artifactId>ant</artifactId>
                                <version>1.8.4</version>
                            </dependency>
                            <dependency>
                                <groupId>ant-contrib</groupId>
                                <artifactId>ant-contrib</artifactId>
                                <version>1.0b3</version>
                            </dependency>
                        </dependencies>
                    </plugin>
	            <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
			<executions>
                            <execution>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>copy</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>com.intel.mtwilson.kms</groupId>
                                            <artifactId>kms-kmip-client</artifactId>
					    <version>1.1</version>
					    <classifier>generic</classifier>
                                            <type>zip</type>
					    <outputDirectory>${project.build.directory}/dist</outputDirectory>
                                            <destFileName>kms-kmip-client-dist.zip</destFileName>
				       </artifactItem>
				      <artifactItem>
                                            <groupId>com.github.libkmip</groupId>
                                            <artifactId>libkmip-dist</artifactId>
                                            <version>1.0</version>
                                            <classifier>generic</classifier>
                                            <type>zip</type>
					    <outputDirectory>${project.build.directory}/dist</outputDirectory>
                                            <destFileName>lib-kmip-dist.zip</destFileName>
                                        </artifactItem>

                                    </artifactItems>
                                </configuration>
			</execution>
		   </executions>
                        <dependencies>
                            <dependency>
                                <groupId>com.intel.mtwilson.kms</groupId>
                                <artifactId>kms-kmip-client</artifactId>
                                <version>1.1</version>
				<type>zip</type>
				<classifier>generic</classifier>
			</dependency>
			<dependency>
            			<groupId>com.github.libkmip</groupId>
        			<artifactId>libkmip-dist</artifactId>
            			<type>zip</type>
            			<version>1.0</version>
            			<classifier>generic</classifier>
		        </dependency>
                    </dependencies>
		</plugin>
		<plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unzip-lib-kmip</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
					    <unzip dest="${project.build.directory}/dist">
                                            <fileset dir="${project.build.directory}/dist">
                                                <include name="kms-kmip-client-dist.zip"/>
                                            </fileset>
                                        </unzip>
                                        
                                        <unzip dest="${project.build.directory}/dist">
                                            <fileset dir="${project.build.directory}/dist">
                                                <include name="lib-kmip-dist.zip"/>
                                            </fileset>
				       </unzip>
				       <copy todir="${project.basedir}/src/main/application/share/lib">
					       <fileset dir="${project.build.directory}/dist">
						       <include name="**/*.so*"/>
					       </fileset>
					       <mapper type="flatten"/>
					</copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                        <dependencies>
                            <dependency>
                                <groupId>org.apache.ant</groupId>
                                <artifactId>ant</artifactId>
                                <version>1.8.4</version>
                            </dependency>
                            <dependency>
                                <groupId>ant-contrib</groupId>
                                <artifactId>ant-contrib</artifactId>
                                <version>1.0b3</version>
                            </dependency>
                        </dependencies>
                    </plugin>
        </plugins>
    </build>
    <profiles>
        <profile>
            <id>default</id>
            <activation>
                <property>
                    <name>mtwilson3</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.intel.mtwilson.kms</groupId>
                    <artifactId>kms-barbican-client</artifactId>
                    <version>${project.version}</version>
                    <classifier>feature</classifier>
                    <type>zip</type>
                </dependency>
                <dependency>
                    <groupId>com.intel.mtwilson.kms</groupId>
                    <artifactId>kms-saml</artifactId>
                    <version>${project.version}</version>
                    <classifier>feature</classifier>
                    <type>zip</type>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>keplerlake</id>
            <activation>
                <property>
                    <name>keplerlake</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.intel.mtwilson.kms</groupId>
                    <artifactId>kms-keystore-tpm</artifactId>
                    <version>${project.version}</version>
                </dependency>
                <dependency>
                    <groupId>com.intel.mtwilson.kms</groupId>
                    <artifactId>kms-keystore-keplerlake</artifactId>
                    <version>${project.version}</version>
                </dependency>
                <dependency>
                    <groupId>com.intel.mtwilson.kms</groupId>
                    <artifactId>kms-keys-ws-v2-keplerlake</artifactId>
                    <version>${project.version}</version>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>dhsm2</id>
            <activation>
                <property>
                    <name>dhsm2</name>
                </property>
            </activation>
            <dependencies>
            </dependencies>
        </profile>
    </profiles>

    <dependencies>
        <!-- common-java -->
        <dependency>
            <groupId>com.intel.mtwilson.core</groupId>
            <artifactId>mtwilson-core-feature-inventory</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.core</groupId>
            <artifactId>mtwilson-core-jetty9</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.core</groupId>
            <artifactId>mtwilson-core-setup</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.core</groupId>
            <artifactId>mtwilson-core-jca-setup</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>com.intel.mtwilson.core</groupId>
            <artifactId>mtwilson-core-login-token</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.integration</groupId>
            <artifactId>mtwilson-launcher</artifactId>
        </dependency>
        <!-- also a transitive dependency from kms-keystore and kms-jetty9 -->
        <dependency>
            <groupId>com.intel.mtwilson.integration</groupId>
            <artifactId>mtwilson-configuration</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.integration</groupId>
            <artifactId>mtwilson-password-vault</artifactId>
        </dependency>
        <!-- for the RepeatableRequestFilter -->
        <dependency>
            <groupId>com.intel.mtwilson.services</groupId>
            <artifactId>mtwilson-http-servlets</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.services</groupId>
            <artifactId>mtwilson-shiro-file</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.services</groupId>
            <artifactId>mtwilson-extensions-cache</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.services</groupId>
            <artifactId>mtwilson-extensions-ws-v2</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.services</groupId>
            <artifactId>mtwilson-version-ws-v2</artifactId>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.util</groupId>
            <artifactId>mtwilson-util-jersey2</artifactId>
        </dependency>

        
        <!-- kms -->
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-keys-ws-v2</artifactId>
            <version>${project.version}</version>
            <classifier>feature</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-user</artifactId>
            <version>${project.version}</version>
            <classifier>feature</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-version</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-keystore-directory</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-keystore</artifactId>
            <version>${project.version}</version>
        </dependency>
	    <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-kmip</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-cipher</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-dhsm2-key-transfer-policy</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-dhsm2-key-usage-policy</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-keystore-dhsm</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>com.intel.mtwilson.kms</groupId>
            <artifactId>kms-stm</artifactId>
            <version>${project.version}</version>
        </dependency>
	<dependency>
	    <groupId>com.intel.mtwilson.kms</groupId>
	    <artifactId>kms-dhsm2-session</artifactId>
	    <version>${project.version}</version>
	</dependency>
	<dependency>
	    <groupId>com.intel.mtwilson.kms</groupId>
	    <artifactId>kms-dhsm2-common</artifactId>
	    <version>${project.version}</version>
	</dependency>
	<dependency>
	    <groupId>com.intel.mtwilson.kms</groupId>
	    <artifactId>kms-dhsm2-key-transfer</artifactId>
	    <version>${project.version}</version>
	</dependency>

        
        <!-- external -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <scope>test</scope>
            <type>jar</type>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
        </dependency>
        <dependency>
            <groupId>org.glassfish</groupId>
            <artifactId>javax.servlet</artifactId>
            <version>3.1.1</version>
        </dependency>
        <!-- was 2.2.0 -->
        <dependency>
            <groupId>org.glassfish.jersey.inject</groupId>
            <artifactId>jersey-hk2</artifactId>
        </dependency>
        <dependency>
            <groupId>org.glassfish.hk2</groupId>
            <artifactId>hk2-api</artifactId>
            <!--version>2.2.0</version--> 
        </dependency>
        <dependency>
            <groupId>org.glassfish.hk2</groupId>
            <artifactId>hk2-utils</artifactId>
            <!--version>2.2.0</version-->
        </dependency>
        
        <!-- jersey -->
        <dependency>
            <groupId>org.glassfish.jersey.core</groupId>
            <artifactId>jersey-client</artifactId>
            <!--version>2.10.1</version-->
        </dependency>
        <dependency>
            <groupId>org.glassfish.jersey.core</groupId>
            <artifactId>jersey-common</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
        <dependency>
            <groupId>org.glassfish.jersey.core</groupId>
            <artifactId>jersey-server</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
        <dependency>
            <groupId>org.glassfish.jersey.containers</groupId>
            <artifactId>jersey-container-servlet</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
        <dependency>
            <groupId>org.glassfish.jersey.containers</groupId>
            <artifactId>jersey-container-servlet-core</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
        <dependency>
            <!-- Purpose: multipart file upload  used by mtwilson-core-data-bundle -->
            <groupId>org.glassfish.jersey.media</groupId>
            <artifactId>jersey-media-multipart</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
        <dependency>
            <groupId>org.glassfish.jersey.media</groupId>
            <artifactId>jersey-media-json-jackson</artifactId>
            <!--version>2.4.1</version-->
        </dependency>
    </dependencies>
    
</project>
